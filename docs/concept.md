# アプリケーション仕様書（初版）

## 1. 背景・目的

- 昨年は調理やレジ待ちがボトルネックとなり，人的負荷も高かったため，オペレーションの簡素化と会計負荷の削減が必要である（レジ待ちや調理が詰まった旨の言及）
- 会場は電源や Wi-Fi の利用が難しく，モニター常設も現実的でないため，来場者自身のスマホを前提とした仕組みが望ましい（電源無し，Wi-Fi 不可，タブレット前提の制約）
- 目標は，スマホ注文 → 対面支払い → 調理・受け渡し呼び出し を最小デバイスでスムーズに回すこと（スマホで注文し支払いは対面，番号で進行）

## 2. スコープ（MVP）

- 来場者用スマホ Web（注文画面，注文完了共有，呼び出し確認）
- 受付（会計）用スマホ Web（注文検索，支払い確定）
- 受け渡し担当用スマホ Web（調理完了登録，呼び出し）
- 紙シール（または記入票）へのトッピング等の手書き・〇付け運用を前提にし，調理場の電子端末は不要とする方針
- リアルタイム更新は WebSocket を基本とし，来場者側の表示遅延を避ける（ユーザー側は WebSocket 推奨の確認）

## 3. 非スコープ（MVP 外）

- 調理工程の電子化 UI（段階別端末や工程管理は見送り）
- レシートプリンターやラベル自動印刷機の導入（将来の拡張案として検討）

## 4. 利用者ロール

- 来場者（Customer）: 自身のスマホで注文，番号と呼び出し状態を確認する
- 受付係（Cashier）: 受付スマホで注文を呼び出し，現金受領後に「支払い済み」にする
- 受け渡し係（Handoff）: 受け渡しスマホで「調理完了」を押し，番号で呼び出す
- 管理者（Admin）: 在庫や販売停止，メニュー価格の更新を行う（運営効率化のための一般要件）

## 5. ユースケース

- UC-1: 来場者が QR コードから注文サイトへアクセスし，メニュー・トッピングを選んで注文する． 完了時に固有の注文番号が発行される
- UC-2: 受付係は注文番号を提示した来場者から代金を受け取り，受付画面で「支払い済み」に確定する． 注文票（シール）にトッピング等を〇付けして丼に貼付する
- UC-3: 受け渡し係は出来上がり次第「調理完了」を押す． 来場者のスマホ画面と場内の呼び出しで番号を通知する
- UC-4: 来場者は「呼び出し中」表示を確認し，番号を口頭提示して受け取る（番号口頭呼び出しと併用）
- UC-5: 任意で注文完了時に SNS 共有（X でのツイート）を促す（任意機能）

## 6. 機能要件

### 6.1 来場者用（PWA 推奨）

- メニュー表示，オプション選択，数量選択
- 料金自動計算と注文確定
- 注文番号の表示とステータス追従（`受付待ち → 支払い待ち → 調理中 → 受け取り可 → 受け渡し済み`）
- リアルタイム更新（WebSocket），フォールバックでポーリング
- 呼び出し通知（画面強調，バイブレーション API 対応ブラウザでは振動）
- QR 再入場で注文復元（同一端末・同一注文番号の再表示）
- SNS 共有リンク（任意）

### 6.2 受付（会計）用

- 注文番号検索（ハンド入力／QR スキャン対応）
- 合計金額と内訳表示
- 「支払い済み」確定ボタン（確定時刻を記録）
- 注文票出力の補助機能（印字は行わず，紙テンプレートのチェックリストを表示して人手で〇付け）

### 6.3 受け渡し用

- 「支払い済み」一覧（調理待ち順）
- 各注文の内容要点（サイズ，主要トッピング）表示
- 「調理完了」ボタンと「受け渡し済み」ボタン
- 呼び出し中一覧と手動再呼び出し

### 6.4 管理用

- メニュー／価格の管理，売切れ停止
- 営業開始・停止（全体フラグ）
- 在庫簡易管理（残数カウントダウン）
- リアルタイム指標（販売数，残数，ピーク把握）※モニター設置は想定せずスマホ閲覧を前提

## 7. 非機能要件

- デバイス制約: 電源無し，Wi-Fi 無しを想定． すべてスマホ稼働で 8 時間以上の電池を確保（モバイルバッテリー推奨）
- ネットワーク: 携帯回線で動作． 一時的断での再接続と状態整合性を担保
- パフォーマンス: 初回ロード < 2s（4G 相当），主要操作は 100ms 以内の応答
- 可用性: ローカルキャッシュで画面再表示可能，サーバ障害時の簡易オフライン掲示（注文停止表示）
- アクセシビリティ: 大文字号数，コントラスト基準，番号表示の視認性確保
- セキュリティ: 匿名注文 ID と署名付きトークン，管理画面はパスコード保護

## 8. 情報設計・データモデル（最小）

- `Order`

  - `orderId`（短い連番または Base36 6 桁，場内読み上げしやすい形式）
  - `items[] { skuId, qty, price }`
  - `options { size, noodle, vegetable, oil, spice, ... }`（調理票の項目と一致）
  - `status`（PLACED, PAID, COOKING, READY, HANDED）
  - `timestamps { placedAt, paidAt, readyAt, handedAt }`
  - `channel { web }`

- `Menu`

  - `skuId, name, price, isAvailable, maxPerOrder`

- `Setting`

  - `storeOpen, stockCounts, callSound`

## 9. 状態遷移

- `PLACED`（来場者が確定）→ 受付で現金受領 → `PAID` → 調理開始（実務は紙票で進行） → 受け渡し係が「調理完了」 → `READY` → 受け渡し済み → `HANDED`

## 10. 画面要件（ワイヤ概要）

### 10.1 来場者

- Top: メニュー一覧，注文ボタン，合計表示
- 完了: 注文番号の大表示，呼び出し待ち UI，SNS 共有ボタン
- 呼び出し: 現在の自分の状態を大きく表示（`調理中／受け取り可`），番号掲示

### 10.2 受付

- 検索: 注文番号入力，該当表示，金額確認
- 操作: 「支払い済み」ボタン，間違い防止の二重確認

### 10.3 受け渡し

- リスト: `PAID/COOKING` の FIFO 表示
- 操作: 「調理完了」「受け渡し済み」
- 呼出: 番号のフルスクリーン提示，音またはバイブ

## 11. 印刷物・アナログ運用

- 注文票テンプレ（耐水シールや短冊）に，サイズ・油・辛さ等の項目枠とチェック欄を印刷． 受付で〇付けして丼に貼る運用を標準とする（スタンプ案からチェック票案へ収束）
- 会場掲示用の大型 QR ポスターを設置． 個別配布札は任意（大判 1 枚でも可）

## 12. 技術要件

- フロント: PWA（React など），Service Worker でキャッシュ，IndexedDB に注文メタを保持
- リアルタイム: WebSocket（サーバは Socket.IO 等）． フォールバックで短周期ポーリング（受け渡し側は確実性優先）
- サーバ: 軽量な REST + WS． データはマネージド DB（SQLite+Litestream あるいは Supabase 等）を想定
- QR: URL は短縮し，`?oid=` で注文番号復元
- テレメトリ: Pageview と状態遷移のイベント計測（オフラインバッファ）

## 13. 運用・当日体制

- 端末: 受付用スマホ 1 台，受け渡し用スマホ 1 台． 余力があれば調理場閲覧用 iPad 1 台（必須ではない）
- 電源・通信: モバイル回線前提，モバイルバッテリー常備
- 紙資材: 注文票シール，ペン，簡易クリップボード
- 現金運用: 釣銭と金庫，売上はレポートで概算照合

## 14. リスクと対策

- 通信不良: 受付・受け渡し画面はエラー時に「口頭運用モード」に切替． 番号手書き台帳で継続
- 電池切れ: 受け渡し端末はモバイルバッテリー常時接続
- 誤操作: 支払い確定と受け渡し確定は取り消し API を用意
- 混雑ピーク: 呼び出しキューの可視化と一時的な注文停止スイッチを用意

## 15. スケジュール目安

- 仕様確定会の実施（9/27 土の 12-16 時想定）と早期実装着手の合意あり． イベントは 11 月上旬想定のため，1 週間程度で MVP を成立させる方針（会話上の意図）

## 16. API（最小案）

```
POST /orders
  body: { items: [], options: {}, deviceId }
  res: { orderId, status: "PLACED" }

GET /orders/:orderId
  res: { orderId, status, items, options, timestamps }

POST /orders/:orderId/pay
  res: { status: "PAID", paidAt }

POST /orders/:orderId/ready
  res: { status: "READY", readyAt }

POST /orders/:orderId/handed
  res: { status: "HANDED", handedAt }

GET /menu
  res: [ { skuId, name, price, isAvailable } ]

POST /admin/menu/:skuId/toggle
POST /admin/store/stop
```

## 17. 受入基準（抜粋）

- 来場者がスマホのみで注文確定し，番号と状態がリアルタイムに更新されること
- 受付で「支払い済み」に変更すると，受け渡し画面のキューに即時反映されること
- 受け渡しで「調理完了」を押すと，来場者画面が「受け取り可」を表示すること
- 紙の注文票のみで調理工程が回り，調理場用の電子端末が無くても運用できること

## 18. 今後の拡張（任意）

- ラベルプリンター連携や音声読み上げ
- 在庫自動減算と売り切れ自動停止
- 人気メニューや時間帯別販売数の可視化
- X 連携の自動テキスト生成（注文番号と店舗ハッシュタグ）
